<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dota2 Calculator (Core / Mid / Support)</title>
  <style>
    :root{
      --bg:#0f1222; --card:#161a31; --card2:#1b2040; --text:#e9ecf8; --muted:#a9b0c7; --accent:#7aa2ff; --green:#6be4a7; --red:#ff7a95; --blue:#7ad1ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 800px at 0% 0%, #121636 0, #0f1222 40%, #0f1222 100%);
      color:var(--text); line-height:1.45;
    }
    header{
      padding:24px; display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      border-bottom:1px solid #24294d;
    }
    h1{font-size:24px; margin:0; font-weight:800; letter-spacing:0.3px}
    .sub{color:var(--muted); font-size:14px}
    .container{max-width:1200px; margin:0 auto; padding:20px;}

    .role-grid{display:grid; grid-template-columns:repeat(3,minmax(280px,1fr)); gap:18px;}
    @media (max-width: 1050px){ .role-grid{grid-template-columns:1fr} }

    .card{background:linear-gradient(180deg, var(--card), var(--card2)); border:1px solid #22284a; border-radius:16px; box-shadow:0 20px 40px rgba(0,0,0,.35);}
    .card-header{padding:14px 16px; border-bottom:1px solid #22284a; display:flex; align-items:center; justify-content:space-between; gap:10px}
    .role-title{font-weight:700; letter-spacing:.3px}

    .row {
      display: grid;
      grid-template-columns: 2.5fr 1.6fr 0fr 1.1fr 1.1fr;
      gap: 12px;
      padding: 8px 12px;
      align-items: center;
    }
    .row.head{color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:.08em}
    .row:nth-child(odd){background:rgba(255,255,255,.02)}

    select, input[type=number]{
      appearance:none; width:100%; padding:10px 12px; border-radius:10px; border:1px solid #2a3160; background:#0e1230; color:var(--text);
      outline:none; font-size:14px; transition:border .2s ease, box-shadow .2s ease;
    }
    select:focus, input[type=number]:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(122,162,255,.2)}

    .sum{padding:10px 12px; display:flex; justify-content:flex-end; gap:18px; border-top:1px dashed #2a3160; color:var(--accent); font-weight:700}
    .sum .label{color:var(--muted); font-weight:600}

    .grand-total{margin-top:20px; padding:16px; display:flex; gap:22px; justify-content:flex-end; align-items:center; background:#12163a; border:1px solid #2a3160; border-radius:14px}
    .badge{padding:6px 10px; border-radius:999px; background:#0d132d; border:1px solid #2a3160; color:var(--muted); font-size:12px}
    .num{font-variant-numeric:tabular-nums}
    .hint{font-size:12px; color:var(--muted)}

    .footer {
      padding: 24px;
      color: var(--muted);
      text-align: center;
      font-size: 14px;
      border-top: 1px solid #2a3160;
      margin-top: 30px;
    }

    .footer a {
      color: var(--accent);
      font-weight: 600;
      text-decoration: none;
    }

    .footer a:hover {
      text-decoration: underline;
      color: #9fb6ff;
    }

    .footer p {
      margin: 8px 0;
    }

    a{color:#9fb6ff}
  </style>
</head>
<body>
  <header>
    <div>
      <h1>Dota2 Fantasy Points Calculator 2025</h1>
      <div class="sub">Based on Maroomm`s data</div>
    </div>
    <div class="badge">100% client‑side · gluten-free · eco-friendly </div>
  </header>

  <div class="container">

    <div class="role-grid" id="roleGrid"></div>

    <div class="grand-total" id="grandTotal" hidden>
      <div class="label">Grand total:</div>
      <div><span class="hint">Result average</span><div class="num" id="gtAvg">0</div></div>
      <div><span class="hint">Result max</span><div class="num" id="gtMax">0</div></div>
    </div>

    <div class="footer">
      <p>
          Huge thanks to <b>Maroomm</b> for his excellent guide:<br>
          <a href="https://www.reddit.com/r/DotA2/comments/1mx8hfa/fantasy_league_guide_2025_road_to_the" target="_blank">
          Fantasy League Guide 2025 – Road to The International
          </a>
      </p>
      <p>
          Built and maintained by <b>denshust</b> · 
          <a href="https://buymeacoffee.com/denshust" target="_blank">☕ Buy me a coffee</a>
      </p>
    </div>

  </div>

  <script>
    // --- Utility helpers ---
    function parseCSV(text){
      const lines = text.replace(/\r/g,'').trim().split(/\n+/);
      const headers = lines[0].split(',').map(s=>s.trim());
      const rows = lines.slice(1).map(line=>line.split(',').map(s=>s.trim()));
      return { headers, rows };
    }

    function parseCell(cell){
      if(!cell) return {avg:0, max:0};
      const parts = String(cell).split('/');
      const avg = parseFloat(parts[0].replace(/[^0-9.\-]/g,'')) || 0;
      const mx  = parts[1] !== undefined ? (parseFloat(parts[1].replace(/[^0-9.\-]/g,'')) || 0) : 0;
      return {avg, max:mx};
    }

    function fmt(n){ return Number(n).toLocaleString(undefined,{maximumFractionDigits:1}); }

    const metricGroups = {
      Red:["GPM - ЗЗХ","Deaths - Смерті","Creeps - Кріпи","Shards - Зібраний Лютит","Kills - Убивства","Towers - Знищення Веж"],
      Green:["Teamfight - Командні Бої","Stuns - Приголомшення","Tormentor - Мучитель","Roshan - Убивства Рошана","First Blood - Перша Кров","Courier - Курєри"],
      Blue:["Wards - Оглядових Вардів","Stacks - Заскиртовані Табори","Lotuses - Лотуси","Watchers - Спостерігачі","Runes - Рун Підібрано","Smokes - Дим"]
    };

    const roleConfig = {
      Core:["Red","Green","Red"],
      Mid:["Red","Blue","Green"],
      Support:["Blue","Green","Blue"]
    };

    // --- Role component ---
    class RoleSection{
      constructor(root, roleName, csvData){
        this.roleName = roleName;
        this.root = root;
        this.data = parseCSV(csvData);
        this.state = { player:null, metrics:[null,null,null], multipliers:[100,100,100], prefix:null, prefixBonus:0 };
        this.build();
        this.afterLoad();
      }

// ------------------ COMPLETE build() ------------------
build(){
  this.card = document.createElement('div');
  this.card.className = 'card';
  this.card.innerHTML = `
    <div class="card-header">
      <div class="role-title">${this.roleName}</div>
    </div>
    <div class="file-row">
      <select class="playerSel"></select>
    </div>
    <div class="row head">
      <div>Metric</div>
      <div>Multiplier (%)</div>
      <div></div>
      <div>Result average</div>
      <div>Result max</div>
    </div>
    <div class="rows"></div>

    <!-- SUM (without prefix) - remains right under the metrics -->
    <div class="sum" data-sum-block>
      <div><span class="label">Sum:</span></div>
      <div>Avg <span class="num" data-sum-avg>0</span></div>
      <div>Max <span class="num" data-sum-max>0</span></div>
    </div>
  `;
  this.root.appendChild(this.card);

  // hosts & references
  this.rowsHost = this.card.querySelector('.rows');

  // Sum (without prefix)
  this.sumAvgEl = this.card.querySelector('[data-sum-avg]');
  this.SumaxEl = this.card.querySelector('[data-sum-max]');

  // Metric rows
  this.metricRows = roleConfig[this.roleName].map((color, idx)=>this.createMetricRow(idx, color));

  // player select
  this.playerSel = this.card.querySelector('.playerSel');
  this.playerSel.addEventListener('change', ()=>{ 
    this.state.player = this.playerSel.value; 
    this.populatePrefixes(); 
    this.update(); 
  });

  // ----- Prefix controls + result cells (placed after Sum) -----
  this.prefixRow = document.createElement('div');
  this.prefixRow.className = 'row';
  this.prefixRow.innerHTML = `
    <div>
      <strong>Prefix</strong><br/>
      <select class="prefixSel"><option value="" disabled selected>Choose prefix…</option></select>
    </div>

    <div>
      <strong>Prefix %</strong><br/>
      <input class="prefixBonus" type="number" step="1" value="0" min="0"/>
    </div>

    <div></div>

    <div>
      <div class="hint">Prefix Avg</div>
      <div class="num" data-prefix-avg>0</div>
    </div>

    <div>
      <div class="hint">Prefix Max</div>
      <div class="num" data-prefix-max>0</div>
    </div>
  `;
  // insert prefix row after the SUM block so it visually sits under the prefix controls
  const sumBlock = this.card.querySelector('[data-sum-block]');
  sumBlock.insertAdjacentElement('afterend', this.prefixRow);

  this.prefixSel = this.prefixRow.querySelector('.prefixSel');
  this.prefixBonusInput = this.prefixRow.querySelector('.prefixBonus');
  this.prefixAvgEl = this.prefixRow.querySelector('[data-prefix-avg]');
  this.prefixMaxEl = this.prefixRow.querySelector('[data-prefix-max]');

  this.prefixSel.addEventListener('change', ()=>{ this.state.prefix = this.prefixSel.value; this.update(); });
  this.prefixBonusInput.addEventListener('input', ()=>{ this.state.prefixBonus = parseFloat(this.prefixBonusInput.value)||0; this.update(); });

  // ----- Total row (at bottom of card) -----
  this.totalRow = document.createElement('div');
  this.totalRow.className = 'sum';
  this.totalRow.innerHTML = `
    <div><span class="label">Total:</span></div>
    <div>Avg <span class="num" data-total-avg>0</span></div>
    <div>Max <span class="num" data-total-max>0</span></div>
  `;
  this.card.appendChild(this.totalRow);

  this.totalAvgEl = this.totalRow.querySelector('[data-total-avg]');
  this.totalMaxEl = this.totalRow.querySelector('[data-total-max]');
}
// ---------------- end build() ------------------

        // ---------------- end build() ------------------

      createMetricRow(idx, color){
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `
        <select class="metricSel" style="border:2px solid ${
            color==='Red'?'var(--red)':color==='Green'?'var(--green)':'var(--blue)'
        }"></select>
        <input class="mult" type="number" step="10" value="100" min="0"/>
        <div></div>
        <div class="num" data-avg>0</div>
        <div class="num" data-max>0</div>
        `;
        this.rowsHost.appendChild(row);
        const metricSel = row.querySelector('.metricSel');
        const multInput = row.querySelector('.mult');
        metricSel.addEventListener('change', ()=>{ this.state.metrics[idx] = metricSel.value; this.update(); });
        multInput.addEventListener('input', ()=>{ this.state.multipliers[idx] = parseFloat(multInput.value)||0; this.update(); });
        return {row, metricSel, multInput, avgEl:row.querySelector('[data-avg]'), maxEl:row.querySelector('[data-max]'), color};
      }

      afterLoad(){
        const players = this.data.rows.map(r=>r[0]);
        this.playerSel.innerHTML = '<option value="" disabled selected>Choose player…</option>' + players.map(p=>`<option>${p}</option>`).join('');
        this.metricRows.forEach(mr=>{
          const allowed = metricGroups[mr.color].filter(m=>this.data.headers.includes(m));
          mr.metricSel.innerHTML = '<option value="" disabled selected>Choose metric…</option>' + allowed.map(m=>`<option>${m}</option>`).join('');
        });
      }

      populatePrefixes(){
        if(!this.state.player || !prefixData[this.state.player]) return;
        const options = Object.keys(prefixData[this.state.player]).map(p=>`<option>${p}</option>`).join('');
        this.prefixSel.innerHTML = '<option value="" disabled selected>Choose prefix…</option>' + options;
      }

      getCell(player, metric){
        if(!this.data) return {avg:0,max:0};
        const pIdx = this.data.rows.findIndex(r=>r[0]===player);
        const mIdx = this.data.headers.indexOf(metric);
        if(pIdx<0 || mIdx<0) return {avg:0,max:0};
        return parseCell(this.data.rows[pIdx][mIdx]);
      }

      // Update function (with prefix contribution split)
      // ------------------ COMPLETE update() ------------------
update(){
  // 1) compute Sum (no prefix) and show per-metric results
  let sumAvg = 0, sumMax = 0;
  for(let i=0;i<3;i++){
    const metric = this.state.metrics[i];
    const mult = (this.state.multipliers[i]||0)/100;
    const {avg,max} = this.getCell(this.state.player, metric);
    const rAvg = avg*mult, rMax = max*mult;
    sumAvg += rAvg; sumMax += rMax;
    const mr = this.metricRows[i];
    mr.avgEl.textContent = fmt(rAvg);
    mr.maxEl.textContent = fmt(rMax);
  }

  // show Sum (without prefix) under the metrics
  this.sumAvgEl.textContent = fmt(sumAvg);
  this.SumaxEl.textContent = fmt(sumMax);

  // 2) compute prefix contribution (expected value) and show under prefix controls
  let prefixBonusAvg = 0, prefixBonusMax = 0;
  if(this.state.player && this.state.prefix && prefixData[this.state.player]){
    const chance = prefixData[this.state.player][this.state.prefix] || 0; // percent
    const bonus = this.state.prefixBonus || 0; // percent
    const factor = (chance/100) * (bonus/100); // fraction
    prefixBonusAvg = sumAvg * factor;
    prefixBonusMax = sumMax * factor;
  }

  // Put prefix contributions under the prefix controls (title above, value below)
  this.prefixAvgEl.textContent = fmt(prefixBonusAvg);
  this.prefixMaxEl.textContent = fmt(prefixBonusMax);

  // 3) total = sum + prefix contribution, show at bottom of the card
  const totalAvg = sumAvg + prefixBonusAvg;
  const totalMax = sumMax + prefixBonusMax;

  this.totalAvgEl.textContent = fmt(totalAvg);
  this.totalMaxEl.textContent = fmt(totalMax);

  // dispatch event — keep same keys so global grand total still works (total values)
  document.dispatchEvent(new CustomEvent('role:updated', {
    detail:{
      role: this.roleName,
      sumAvg: totalAvg,   // grand totals expect the total values here
      Sumax: totalMax
    }
  }));
}
// ---------------- end update() ------------------

        /* ---------------- end update() ------------------ */
    }

// --- Demo CSVs for Core, Mid, Support (replace with your own) ---
    const coreCSV = `Player,GPM - ЗЗХ,Deaths - Смерті,Creeps - Кріпи,Shards - Зібраний Лютит,Kills - Убивства,Towers - Знищення Веж,Teamfight - Командні Бої,Stuns - Приголомшення,Tormentor - Мучитель,Roshan - Убивства Рошана,First Blood - Перша Кров,Courier - Курєри
Yatoro,1590/1981,1195/1800,1605/3038,602/912,1172/2622,1097/2609,1275/1748,464/1705,908/1983,695/1983,193/1700,386/1983
Akashi,1403/1586,1260/1620,1268/1683,566/665,835/1291,850/1813,1376/1613,1185/2850,340/850,510/1417,340/1133,255/850
Satanic,1538/2134,1322/1800,1539/3097,575/893,887/2501,1156/3060,1164/1730,304/2212,773/2267,541/2550,247/1700,124/1133
Yuma,1410/1742,1095/1800,1339/2356,613/855,1266/2380,1002/2267,1309/1677,633/2388,712/1700,391/1417,230/1700,161/1417
Nightfall,1440/1784,1273/1800,1347/2435,580/1051,961/1896,995/2607,1159/1503,677/2349,989/2550,402/1983,185/1700,93/850
shiro,1447/1895,1277/1800,1384/2466,548/678,897/2097,1302/3060,1157/1662,349/1445,754/1983,674/1983,192/1700,96/1417
skiter,1400/1771,1240/1740,1386/2306,602/817,883/1896,718/2153,1144/1547,635/1808,944/1983,283/1417,63/567,252/1700
Ghost,1390/1855,1210/1800,1380/2842,547/855,816/1976,998/2720,1076/1594,473/2031,669/1983,597/2267,145/1700,109/1133
miCKe,1477/2009,1154/1800,1322/2206,544/665,982/2662,940/2833,1130/1690,414/2167,600/1983,450/1700,167/1700,117/1133
watson,1381/1730,1210/1800,1237/2730,557/1020,803/1734,931/2947,1221/1811,351/2099,711/1983,432/1700,251/1700,167/1133
Pure,1416/1915,1148/1800,1274/2322,556/760,898/2138,1030/2493,1168/1654,389/1709,631/1700,451/1700,77/1700,116/850
gotthejuice,1530/1885,1288/1800,1376/1913,553/665,777/1734,823/1927,1178/1639,279/921,626/1700,537/1700,0/0,179/850
JaCkky,1314/1769,1299/1800,1253/2085,546/735,860/2178,789/2720,1150/1729,464/1275,516/1700,425/1417,121/1133,91/850
Wisper,1234/1599,973/1680,1107/2031,620/855,890/1976,266/1133,1335/.1697,1042/2641,551/1700,115/1133,322/1700,368/1700
Ame,1436/2977,1171/1800,1361/2647,563/792,694/1775,852/1947,1072/1763,330/2015,443/1700,407/1700,148/1700,148/1133
Crystallis,1308/1641,1166/1800,1142/2060,542/728,809/2017,619/1927,1308/1641,525/1958,520/2267,304/1700,203/1700,89/850`;
    const midCSV = `Player,GPM - ЗЗХ,Deaths - Смерті,Creeps - Кріпи,Shards - Зібраний Лютит,Kills - Убивства,Towers - Знищення Веж,Teamfight - Командні Бої,Stuns - Приголомшення,Tormentor - Мучитель,Roshan - Убивства Рошана,First Blood - Перша Кров,Courier - Курєри,Wards - Оглядових Вардів,Stacks - Заскиртовані Табори,Lotuses - Лотуси,Watchers - Спостерігачі,Runes - Рун Підібрано,Smokes - Дим
bzm,1289/1587,1241/1800,1076/1950,536/728,919/2097,467/2153,1318/1807,1383/5564,444/1700,343/1700,127/1700,317/1983,100/100,100/100,100/100,100/100,1500/2000,100/100
kiyotaka,1290/1747,937/1800,1182/2223,574/988,1082/2904,271/1473,1248/1713,1132/4911,472/1983,378/1700,31/567,220/1700,100/100,100/100,100/100,100/100,1500/2000,100/100
4nalog,1218/1518,1143/1800,1162/2012,621/855,831/2138,368/1473,1252/1672,1134/4019,459/1700,436/1983,46/567,345/2550,100/100,100/100,100/100,100/100,1500/2000,100/100
Larl,1205/1482,1093/1800,1078/1950,597/880,948/2178,243/1020,1324/1681,1556/6161,283/1133,202/850,202/1700,121/850,100/100,100/100,100/100,100/100,1500/2000,100/100
Mac(*),1262/1420,1368/1740,988/1337,555/665,1137/1815,782/1473,1527/1769,470/1315,425/850,170/567,170/567,170/567,100/100,100/100,100/100,100/100,1500/2000,100/100
Marl1ne,1214/1655,1047/1740,1057/1740,597/804,869/1896,416/1813,1255/1609,942/2106,598/1700,252/1417,63/567,157/1133,100/100,100/100,100/100,100/100,1500/2000,100/100
Nisha,1183/1568,1165/1800,928/1718,536/665,902/1815,373/1133,1273/1755,828/3004,317/1700,333/1983,67/1133,300/850,100/100,100/100,100/100,100/100,1500/2000,100/100
gpk,1203/1550,1407/1800,1011/1688,553/747,961/2299,381/1700,1329/1745,755/3436,438/1700,219/1133,52/1133,103/1133,100/100,100/100,100/100,100/100,1500/2000,100/100
No[o]ne,1197/1740,1008/1740,1048/2107,573/868,823/1896,179/680,1346/1851,1012/4035,325/1317,216/1133,247/1700,201/1133,100/100,100/100,100/100,100/100,1500/2000,100/100
Niku,1228/1470,1184/1680,1049/1659,559/665,656/1291,268/680,1311/1811,976/2438,224/1133,134/850,268/1700,224/850,100/100,100/100,100/100,100/100,1500/2000,100/100
SumaiL,1154/1588,1245/1800,1023/2118,548/830,829/2097,195/1247,1264/1708,756/3933,127/1417,181/1417,109/1700,181/850,100/100,100/100,100/100,100/100,1500/2000,100/100
Xm,1148/2490,1143/1800,1000/1975,559/792,675/1694,301/1360,1266/1777,673/2967,320/1417,136/850,25/567,357/1700,100/100,100/100,100/100,100/100,1500/2000,100/100
RCY,1151/1556,1140/1740,906/1667,509/665,769/1936,296/1247,1369/1801,960/3190,349/1700,174/1133,131/1700,65/850,100/100,100/100,100/100,100/100,1500/2000,100/100
Quinn,1169/1577,1080/1800,977/2021,545/925,835/2218,440/2040,1275/1790,748/4268,237/1700,195/1417,84/1700,181/1417,100/100,100/100,100/100,100/100,1500/2000,100/100
NothingToSay,1156/1591,1114/1800,967/1938,543/684,794/1775,58/567,1345/1757,941/4520,417/2267,144/1417,96/1700,80/1133,100/100,100/100,100/100,100/100,1500/2000,100/100
Armel,1106/1389,1189/1740,968/1675,550/747,722/1613,279/907,1372/1747,522/1929,334/1133,304/1133,61/567,121/850,100/100,100/100,100/100,100/100,1500/2000,100/100`;
    const supportCSV = `Player,Teamfight - Командні Бої,Stuns - Приголомшення,Tormentor - Мучитель,Roshan - Убивства Рошана,First Blood - Перша Кров,Courier - Курєри,Wards - Оглядових Вардів,Stacks - Заскиртовані Табори,Lotuses - Лотуси,Watchers - Спостерігачі,Runes - Рун Підібрано,Smokes - Дим
Mira,1264/1699,2019/6784,634/1983,46/850,340/1700,510/2267,966/1883,742/2550,1088/2698,172/1049,345/928,741/1509
KJ,1198/1634,1032/3531,436/1417,46/567,138/1700,276/1133,1594/2712,1029/2550,864/2343,0/0,520/1049,1323/2358
Scofield,1239/1664,2428/5226,345/1700,115/1133,138/1700,391/1700,510/866,827/1813,1456/3763,0/0,409/1129,405/1226
rue,1208/1659,1872/5436,406/1700,58/850,270/1700,734/3683,855/1620,769/2210,905/2343,347/1694,311/847,334/943
Sneyking,1168/1565,931/3186,693/1983,0/0,63/567,63/567,1155/1770,397/963,1112/2840,802/3025,632/1129,870/1792
Miposhka,1268/1717,1161/4006,444/1417,39/567,155/1700,309/2267,1220/2411,742/1813,363/1349,462/1815,388/928,1331/2736
tofu,1309/1895,1907/8545,432/1700,28/567,28/567,446/2550,745/1205,1045/2833,862/2201,204/2057,300/1049,534/1415
XinQ,1348/1792,2210/7725,290/1417,155/1133,309/1700,174/1417,706/1544,680/1473,576/1775,168/1573,470/1331,553/1604
Boxi,1248/1838,1853/5676,233/1133,50/850,133/1700,283/1983,953/1695,893/3117,576/1491,109/847,383/887,993/1698
Tims,1178/1647,1172/2593,334/1133,152/850,182/1700,698/1700,795/1281,613/1473,1278/2414,0/0,493/1089,697/1415
OmaR,1193/1695,1568/5667,344/1417,72/1133,289/1700,289/850,1116/2185,619/2097,748/2485,0/0,291/887,951/2075
Bignum,1179/1687,1329/3491,414/1700,0/0,174/1700,501/2833,971/1846,510/1190,502/1491,307/1573,351/847,1219/2075
Jing(*),1316/1476,1499/2695,170/567,170/567,340/1133,510/1133,588/753,1105/1870,852/1633,0/0,339/565,481/849
Whitemon,1208/1776,830/2909,304/1983,76/850,178/1700,228/1700,1334/2335,764/1813,610/2343,179/1815,327/968,1309/2358
9Class,1214/1740,1474/7481,294/1700,124/850,278/1700,541/3683,828/1582,791/2267,864/2840,196/1694,374/1049,247/943
Cr1t-,1055/1437,1205/2879,567/1700,126/850,63/567,441/1983,833/1582,957/2663,592/1704,224/726,381/847,744/1698
Saksa,1312/1856,1414/4750,495/1983,51/850,178/1700,546/2550,503/942,700/2437,1014/3266,119/1170,544/1291,275/1038
Zayac,1290/1744,984/2564,224/850,0/0,268/1700,671/2550,886/1243,1101/2210,561/1278,0/0,350/807,804/1226
Save-,1292/1671,1817/4322,438/1700,142/1133,129/1700,129/850,623/1168,538/1813,168/923,57/807,292/645,986/1698
GH,1275/1750,1423/5078,380/1700,0/0,326/1700,253/1417,777/1318,445/1700,512/1562,0/0,409/847,771/1509
Dukalis,1312/1772,484/1987,294/1700,124/850,93/1700,108/1133,1107/2448,522/1700,616/1988,130/1049,284/726,1472/2830
panto,1276/1684,960/3359,541/2550,0/0,340/1700,93/850,976/1959,661/2153,267/1349,145/1170,275/847,978/2075
planet,1291/1708,1402/3907,305/1417,64/850,128/1700,449/2550,518/1055,690/1983,643/2130,112/1008,324/1089,671/1415`;

    // --- Prefix CSV ---
    const prefixCSV = `Yatoro,Dashing - Елегантний ?(68%),Virtuoso - Віртуозний ?(34%),Emerald - Смарагдовий(35%),Crimson - Керамзиновий(23%),Otherwordly - Потойбічний(20%),Brawny - М’язистий(16%),Hirsute - Кошлатий(16%)
Akashi,Dashing - Елегантний ?(60%),Brawny - М’язистий(40%),Celurean(20%),Virtuoso - Віртуозний ?(20%),Otherwordly - Потойбічний(20%)
Satanic,Dashing - Елегантний ?(65%),Otherwordly - Потойбічний(42%),Virtuoso - Віртуозний ?(35%),Elemental - Елементальний(24%),Hirsute - Кошлатий(24%),Bestial - Звірячий(24%)
Yuma,Dashing - Елегантний ?(51%),Virtuoso - Віртуозний ?(39%),Otherwordly - Потойбічний(30%),Elemental - Елементальний(27%),Hirsute - Кошлатий(27%),Crimson - Керамзиновий(27%)
Nightfall,Coveted - Жаданий(93%),Brawny - М’язистий(45%),Dashing - Елегантний ?(33%),Cerulean - Блакитний ?(24%)Otherwordly - Потойбічний(24%),Balanced - Урівноважений(22%)
shiro,Dashing - Елегантний ?(64%),Otherwordly - Потойбічний(30%),Virtuoso - Віртуозний ?(28%),Bestial - Звірячий(23%),Emerald - Смарагдовий(21%),Cerulean - Блакитний ?(15%)
skiter,Brawny - М’язистий(52%),Dashing - Елегантний ?(26%),Emerald - Смарагдовий(26%),Hirsute - Кошлатий(26%),Balanced - Урівноважений(22%),Virtuoso - Віртуозний ?(19%)
Ghost,Dashing - Елегантний ?(77%),Elemental - Елементальний(32%),Virtuoso - Віртуозний ?(32%),Otherwordly - Потойбічний(23%),Emerald - Смарагдовий(21%),Crimson - Керамзиновий(21%)
miCKe,Dashing - Елегантний ?(47%),Emerald - Смарагдовий(24%),Brawny - М’язистий(24%),Otherwordly - Потойбічний(24%),Hirsute - Кошлатий(24%),Balanced - Урівноважений(24%)
watson,Dashing - Елегантний ?(62%),Otherwordly - Потойбічний(36%),Virtuoso - Віртуозний ?(34%),Bestial - Звірячий(30%),Hirsute - Кошлатий(25%),Crimson - Керамзиновий(21%),Elemental - Елементальний(20%),Balanced - Урівноважений(20%)
Pure,Dashing - Елегантний ?(45%),Emerald - Смарагдовий(33%),Hirsute - Кошлатий(33%),Brawny - М’язистий(26%),Otherwordly - Потойбічний(24%)
gotthejuice,Dashing - Елегантний ?(58%),Otherwordly - Потойбічний(37%),Brawny - М’язистий(26%),Bestial - Звірячий(26%),Elemental - Елементальний(21%),Cerulean - Блакитний ?(21%)
JaCkky,Brawny - М’язистий(46%),Dashing - Елегантний ?(43%),Elemental - Елементальний(25%),Cerulean - Блакитний ?(25%),Virtuoso - Віртуозний ?(25%),Otherwordly - Потойбічний(18%)
Wisper,Hirsute - Кошлатий(70%),Coveted - Жаданий(32%),Brawny - М’язистий(46%),Crimson - Керамзиновий(38%),Balanced - Урівноважений(27%),Canny - Кмітливий(27%),Elemental - Елементальний(24%)
Ame,Dashing - Елегантний ?(62%),Sacrificial - Жертовний(58%),Virtuoso - Віртуозний ?(38%),Otherwordly - Потойбічний(30%),Hirsute - Кошлатий(26%)
Crystallis,Dashing - Елегантний ?(43%),Brawny - М’язистий(39%),Hirsute - Кошлатий(24%),Elemental - Елементальний(19%),Otherwordly - Потойбічний(19%)
bzm,Virtuoso - Віртуозний ?(72%),Canny - Кмітливий(48%),Otherwordly - Потойбічний(39%),Bestial - Звірячий(37%),Crimson - Керамзиновий(34%),Elemental - Елементальний(31%),Hirsute - Кошлатий(30%)
kiyotaka,Sacrificial - Жертовний(56%),Otherwordly - Потойбічний(50%),Canny - Кмітливий(46%),Bestial - Звірячий(41%),Dashing - Елегантний ?(35%),Cerulean - Блакитний ?(35%)
4nalog,Hirsute - Кошлатий(51%),Sacrificial - Жертовний(49%),Virtuoso - Віртуозний ?(43%),Dashing - Елегантний ?(38%),Otherwordly - Потойбічний(35%),Bestial - Звірячий(32%),Crimson - Керамзиновий(30%)
Larl,Otherwordly - Потойбічний(62%),Dashing - Елегантний ?(43%),Hirsute - Кошлатий(38%),Canny - Кмітливий(38%),Crimson - Керамзиновий(36%),Sacrificial - Жертовний(36%),Elemental - Елементальний(31%)
Mac,Balanced - Урівноважений(60%),Sacrificial - Жертовний(50%),Otherwordly - Потойбічний(40%),Crimson - Керамзиновий(30%),Elemental - Елементальний(20%),Virtuoso - Віртуозний ?(20%)
Marl1ne,Virtuoso - Віртуозний ?(74%),Crimson - Керамзиновий(52%),Hirsute - Кошлатий(44%),Bestial - Звірячий(41%),Brawny - М’язистий(30%)
gpk,Otherwordly - Потойбічний(45%),Canny - Кмітливий(39%),Elemental - Елементальний(35%),Cerualean(33%),Hirsute - Кошлатий(33%),Bestial - Звірячий(33%)
Nisha,Otherwordly - Потойбічний(59%),Sacrificial - Жертовний(41%),Hirsute - Кошлатий(39%),Crimson - Керамзиновий(35%),Canny - Кмітливий(33%),Dashing - Елегантний ?(29%),Bestial - Звірячий(29%),Elemental - Елементальний(27%),Cerulean - Блакитний ?(25%)
No[o]ne,Virtuoso - Віртуозний ?(55%),Otherwordly - Потойбічний(51%),Canny - Кмітливий(42%),Bestial - Звірячий(40%),Cerulean - Блакитний ?(35%),Hirsute - Кошлатий(33%),Crimson - Керамзиновий(31%)
Niku,Sacrificial - Жертовний(63%),Virtuoso - Віртуозний ?(53%),Brawny - М’язистий(53%),Cerulean - Блакитний ?(26%),Dashing - Елегантний ?(21%),Otherwordly - Потойбічний(21%)
RCY,Hirsute - Кошлатий(41%),Otherwordly - Потойбічний(38%),Canny - Кмітливий(38%),Coveted - Жаданий(33%),Cerulean - Блакитний ?(28%),Bestial - Звірячий(28%),Brawny - М’язистий(26%)
Quinn,Virtuoso - Віртуозний ?(87%),Canny - Кмітливий(49%),Otherwordly - Потойбічний(44%),Bestial - Звірячий(43%),Cerulean - Блакитний ?(34%),Hirsute - Кошлатий(34%),Dashing - Елегантний ?(33%)
NothingToSay,Hirsute - Кошлатий(57%),Virtuoso - Віртуозний ?(36%),Crimson - Керамзиновий(34%),Canny - Кмітливий(34%),Otherwordly - Потойбічний(32%),Brawny - М’язистий(26%),Bestial - Звірячий(26%)
SumaiL,Hirsute - Кошлатий(49%),Sacrificial - Жертовний(47%),Balanced - Урівноважений(38%),Canny - Кмітливий(36%),Cerualean(34%),Bestial - Звірячий(34%),Otherwordly - Потойбічний(32%)
Xm,Otherwordly - Потойбічний(51%),Hirsute - Кошлатий(39%),Canny - Кмітливий(41%),Virtuoso - Віртуозний ?(39%),Cerulean - Блакитний ?(35%),Balanced - Урівноважений(23%)
Armel,Virtuoso - Віртуозний ?(79%),Otherwordly - Потойбічний(57%),Canny - Кмітливий(43%),Bestial - Звірячий(39%),Crimson - Керамзиновий(32%),Elemental - Елементальний(29%),Hirsute - Кошлатий(29%)
Mira,Canny - Кмітливий(58%),Elemental - Елементальний(27%),Hirsute - Кошлатий(24%),Bestial - Звірячий(22%),Emerald - Смарагдовий(20%),Brawny - М’язистий(18%)
KJ,Elemental - Елементальний(39%),Brawny - М’язистий(43%),Crimson - Керамзиновий(35%),Canny - Кмітливий(32%),Bestial - Звірячий(30%),Coveted - Жаданий(16%),Sacrificial - Жертовний(16%)
Scofield,Canny - Кмітливий(51%),Brawny - М’язистий(41%),Hirsute - Кошлатий(30%),Bestial - Звірячий(27%),Coveted - Жаданий(24%),Emerald - Смарагдовий(16%),Crimson - Керамзиновий(14%)
rue,Canny - Кмітливий(55%),Emerald - Смарагдовий(39%),Dashing - Елегантний ?(30%),Cerulean - Блакитний ?(23%),Otherwordly - Потойбічний(23%),Elemental - Елементальний(20%),Hirsute - Кошлатий(20%)
Sneyking,Coveted - Жаданий(85%),Canny - Кмітливий(59%),Elemental - Елементальний(44%),Bestial - Звірячий(37%),Emerald - Смарагдовий(33%),Otherwordly - Потойбічний(30%),Cerulean - Блакитний ?(26%)
Miposhka,Coveted - Жаданий(75%),Canny - Кмітливий(66%),Crimson - Керамзиновий(32%),Hirsute - Кошлатий(23%),Elemental - Елементальний(20%),Balanced - Урівноважений(20%)
tofu,Canny - Кмітливий(59%),Emerald - Смарагдовий(43%),Coveted - Жаданий(33%),Balanced - Урівноважений(33%),Elemental - Елементальний(18%),Bestial - Звірячий(18%)
XinQ,Canny - Кмітливий(55%),Emerald - Смарагдовий(30%),Hirsute - Кошлатий(30%),Brawny - М’язистий(27%),Bestial - Звірячий(25%),Coveted - Жаданий(18%)
Boxi,Canny - Кмітливий(41%),Balanced - Урівноважений(39%),Emerald - Смарагдовий(35%),Elemental - Елементальний(29%),Coveted - Жаданий(24%),Bestial - Звірячий(22%)
Tims,Brawny - М’язистий(36%),Elemental - Елементальний(29%),Canny - Кмітливий(29%),Dashing - Елегантний ?(25%),Hirsute - Кошлатий(25%),Crimson - Керамзиновий(25%),Sacrificial - Жертовний(21%)
OmaR,Canny - Кмітливий(51%),Balanced - Урівноважений(36%),Elemental - Елементальний(30%),Bestial - Звірячий(28%),Crimson - Керамзиновий(26%),Elemrald(23%)
Bignum,Elemental - Елементальний(38%),Canny - Кмітливий(33%),Balanced - Урівноважений(31%),Brawny - М’язистий(28%),Hirsute - Кошлатий(28%),Sacrificial - Жертовний(21%),
Whitemon,Canny - Кмітливий(66%),Emerald - Смарагдовий(31%),Sacrificial - Жертовний(25%),Hirsute - Кошлатий(24%),Crisom(21%),Virtuoso - Віртуозний ?(19%)
9Class,Canny - Кмітливий(38%),Emerald - Смарагдовий(27%),Balanced - Урівноважений(27%),Crimson - Керамзиновий(27%),Coveted - Жаданий(25%),Sacrificial - Жертовний(24%),Elemental - Елементальний(22%)
Cr1t-,Canny - Кмітливий(59%),Virtuoso - Віртуозний ?(44%),Sacrificial - Жертовний(44%),Emerald - Смарагдовий(26%),Hirsute - Кошлатий(26%)
Saksa,Brawny - М’язистий(43%),Canny - Кмітливий(34%),Hirsute - Кошлатий(28%),Elemental - Елементальний(22%),Bestial - Звірячий(18%),Emerald - Смарагдовий(16%)
Zayac,Hirsute - Кошлатий(53%),Canny - Кмітливий(53%),Bestial - Звірячий(37%),Balanced - Урівноважений(32%),Crimson - Керамзиновий(26%),Emerald - Смарагдовий(21%)
Erice,Virtuoso - Віртуозний ?(60%),Canny - Кмітливий(50%),Dashing - Елегантний ?(40%),Sacrificial - Жертовний(20%)
Save,Canny - Кмітливий(70%),Virtuoso - Віртуозний ?(33%),Otherwordly - Потойбічний(33%),Emerald - Смарагдовий(30%),Balanced - Урівноважений(29%),Coveted - Жаданий(18%)
GH,Brawny - М’язистий(55%),Bestial - Звірячий(36%),Elemental - Елементальний(34%),Coveted - Жаданий(32%),Hirsute - Кошлатий(28%),Emerald - Смарагдовий(19%),Balanced - Урівноважений(19%),Canny - Кмітливий(19%)
Dukalis,Canny - Кмітливий(71%),Virtuoso - Віртуозний ?(51%),Crimson - Керамзиновий(25%),Elemental - Елементальний(20%),Sacrificial - Жертовний(20%),Cerulean - Блакитний ?(18%)
panto,Canny - Кмітливий(60%),Elemental - Елементальний(35%),Crimson - Керамзиновий(35%),Balanced - Урівноважений(33%),Hirsute - Кошлатий(27%),Virtuoso - Віртуозний ?(24%),Emerald - Смарагдовий(22%)
planet,Canny - Кмітливий(47%),Crimson - Керамзиновий(30%),Brawny - М’язистий(28%),Elemental - Елементальний(26%),Balanced - Урівноважений(25%),Emerald - Смарагдовий(23%),Hirsute - Кошлатий(23%),Bestial - Звірячий(21%)`;

    function parsePrefixCSV(text){
  // Split lines, ignore empty lines
  const lines = text.trim().split(/\r?\n/).filter(l => l.trim().length);
  const data = {};
  for(const line of lines){
    const parts = line.split(',').map(p => p.trim()).filter(p => p.length);
    if(parts.length === 0) continue;
    const player = parts[0];
    data[player] = {};
    // Accept any prefix name that doesn't contain parentheses
    for(let i=1;i<parts.length;i++){
      const chunk = parts[i].trim();
      // Match "prefixName(123%)" -- capture any chars except parentheses for name
      const m = chunk.match(/^([^()]+)\((\d+)%\)$/u);
      if(m){
        const name = m[1].trim();
        const chance = parseFloat(m[2]);
        if(name) data[player][name] = chance;
      } else {
        // if you want, keep unmatched chunks for debugging:
        // console.warn('Unparsed prefix chunk:', {player, chunk});
      }
    }
  }
  return data;
}


    const prefixData = parsePrefixCSV(prefixCSV);

    // --- App setup ---
    const roleGrid = document.getElementById('roleGrid');
    const sections = [
      new RoleSection(roleGrid,'Core',coreCSV),
      new RoleSection(roleGrid,'Mid',midCSV),
      new RoleSection(roleGrid,'Support',supportCSV)
    ];

    const gtWrap = document.getElementById('grandTotal');
    const gtAvg = document.getElementById('gtAvg');
    const gtMax = document.getElementById('gtMax');
    const grand = { Core:{a:0,m:0}, Mid:{a:0,m:0}, Support:{a:0,m:0} };

    document.addEventListener('role:updated', (e)=>{
      const {role, sumAvg, Sumax} = e.detail;
      if(grand[role]){ grand[role].a = sumAvg; grand[role].m = Sumax; }
      const totAvg = Object.values(grand).reduce((t,o)=>t+o.a,0);
      const totMax = Object.values(grand).reduce((t,o)=>t+o.m,0);
      gtAvg.textContent = fmt(totAvg);
      gtMax.textContent = fmt(totMax);
      gtWrap.hidden = false;
    });
  </script>
</body>
</html>
